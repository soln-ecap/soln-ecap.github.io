
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>自定义 · NLG-Chat</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-cuav-chapters/cuav-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-accordion/accordion.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-fexa/fexa.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="最佳实践.html" />
    
    
    <link rel="prev" href="参数配置.html" />
    

    </head>
    <body>
        
<div class="book">
	<div class="header-inner">
		<!-- LOGO -->
		<div class="logo"></div>
		<span class="title"></span>

		<!-- Search -->
		
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>


		<!-- Nav -->
		<ul class="header-nav">
			
		</ul>
	</div>

	<div class="book-summary">
		<div class="book-summary-title">文档目录</div>
		
		
		<nav role="navigation">
			


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="支持列表.html">
            
                <a href="支持列表.html">
            
                    
                    支持列表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="开发环境部署.html">
            
                <a href="开发环境部署.html">
            
                    
                    开发环境部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="参数配置.html">
            
                <a href="参数配置.html">
            
                    
                    参数配置
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5" data-path="自定义.html">
            
                <a href="自定义.html">
            
                    
                    自定义
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="最佳实践.html">
            
                <a href="最佳实践.html">
            
                    
                    最佳实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="做出贡献.html">
            
                <a href="做出贡献.html">
            
                    
                    做出贡献
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="常见问题.html">
            
                <a href="常见问题.html">
            
                    
                    常见问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="合作伙伴.html">
            
                <a href="合作伙伴.html">
            
                    
                    合作伙伴
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


		</nav>
		
		
	</div>

	<!-- Content nav -->
	<div class="book-anchor">
		<div class="book-anchor-title">在这篇文章中:</div>
		<div class="book-anchor-body">

		</div>
	</div>

	<div class="book-body">
		
		<div class="body-inner">
			
			

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >自定义</a>
    </h1>
</div>




			<div class="page-wrapper" tabindex="-1" role="main">
				<div class="page-inner">
					
<div id="book-search-results">
    <div class="search-noresults">
    
<div id="book-search-results">
    <div class="search-noresults">
    
					<section class="normal markdown-section">
						
						<h2 id="&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5206;&#x8BCD;&#x5668;">&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5206;&#x8BCD;&#x5668;</h2>
<ol>
<li><p>&#x5728;<code>text_splitter</code>&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x6587;&#x4EF6;&#x540D;&#x4E3A;&#x60A8;&#x7684;&#x5206;&#x8BCD;&#x5668;&#x540D;&#x5B57;&#xFF0C;&#x6BD4;&#x5982;<code>my_splitter.py</code>&#xFF0C;&#x7136;&#x540E;&#x5728;<code>__init__.py</code>&#x4E2D;&#x5BFC;&#x5165;&#x60A8;&#x7684;&#x5206;&#x8BCD;&#x5668;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> .my_splitter <span class="hljs-keyword">import</span> MySplitter
</code></pre>
</li>
<li><p>&#x4FEE;&#x6539;<code>config/kb_config.py</code>&#x6587;&#x4EF6;&#xFF0C;&#x5C06;&#x60A8;&#x7684;&#x5206;&#x8BCD;&#x5668;&#x540D;&#x5B57;&#x6DFB;&#x52A0;&#x5230;<code>text_splitter_dict</code>&#x4E2D;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-python">MySplitter: {
     <span class="hljs-string">&quot;source&quot;</span>: <span class="hljs-string">&quot;huggingface&quot;</span>,  <span class="hljs-comment"># &#x9009;&#x62E9;tiktoken&#x5219;&#x4F7F;&#x7528;openai&#x7684;&#x65B9;&#x6CD5;</span>
     <span class="hljs-string">&quot;tokenizer_name_or_path&quot;</span>: <span class="hljs-string">&quot;your tokenizer&quot;</span>, <span class="hljs-comment">#&#x5982;&#x679C;&#x9009;&#x62E9;huggingface&#x5219;&#x4F7F;&#x7528;huggingface&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x90E8;&#x5206;tokenizer&#x9700;&#x8981;&#x4ECE;Huggingface&#x4E0B;&#x8F7D;</span>
 }
TEXT_SPLITTER = <span class="hljs-string">&quot;MySplitter&quot;</span>
</code></pre>
</li>
</ol>
<p>&#x5B8C;&#x6210;&#x4E0A;&#x8FF0;&#x6B65;&#x9AA4;&#x540E;&#xFF0C;&#x5C31;&#x80FD;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7684;&#x5206;&#x8BCD;&#x5668;&#x4E86;&#x3002;</p>
<h2 id="&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684;-agent-&#x5DE5;&#x5177;">&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684; Agent &#x5DE5;&#x5177;</h2>
<ol>
<li><p>&#x521B;&#x5EFA;&#x81EA;&#x5DF1;&#x7684;Agent&#x5DE5;&#x5177;</p>
</li>
<li><p>&#x5F00;&#x53D1;&#x8005;&#x5728;<code>server/agent</code>&#x6587;&#x4EF6;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x81EA;&#x5DF1;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x6DFB;&#x52A0;&#x5230;<code>tools_select.py</code>&#x4E2D;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x5B8C;&#x6210;&#x4E86;Tools&#x7684;&#x8BBE;&#x5B9A;&#x3002;</p>
</li>
<li><p>&#x5F53;&#x60A8;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;<code>custom_agent.py</code>&#x6587;&#x4EF6;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x4E00;&#x4E2A;<code>work</code>&#x51FD;&#x6570;&#xFF0C;&#x90A3;&#x4E48;&#x60A8;&#x9700;&#x8981;&#x5728;<code>tools_select.py</code>&#x4E2D;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> custom_agent <span class="hljs-keyword">import</span> work
Tool.from_function(
  func=work,
  name=<span class="hljs-string">&quot;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x540D;&#x5B57;&quot;</span>,
  description=<span class="hljs-string">&quot;&quot;</span>
  )
</code></pre>
</li>
<li><p>&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x786E;&#x5B9A;&#x5728;&#x67D0;&#x4E00;&#x4E2A;&#x5DE5;&#x7A0B;&#x4E2D;&#x4E0D;&#x4F1A;&#x4F7F;&#x7528;&#x5230;&#x67D0;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x4ECE;Tools&#x4E2D;&#x79FB;&#x9664;&#xFF0C;&#x964D;&#x4F4E;&#x6A21;&#x578B;&#x5206;&#x7C7B;&#x9519;&#x8BEF;&#x5BFC;&#x81F4;&#x4F7F;&#x7528;&#x9519;&#x8BEF;&#x5DE5;&#x5177;&#x7684;&#x98CE;&#x9669;&#x3002;</p>
</li>
<li><p>&#x4FEE;&#x6539; <code>custom_template.py</code> &#x6587;&#x4EF6;</p>
</li>
</ol>
<p>&#x5F00;&#x53D1;&#x8005;&#x9700;&#x8981;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x9009;&#x62E9;&#x7684;&#x5927;&#x6A21;&#x578B;&#x8BBE;&#x5B9A;&#x9002;&#x5408;&#x8BE5;&#x6A21;&#x578B;&#x7684;Agent Prompt&#x548C;&#x81EA;&#x81EA;&#x5B9A;&#x4E49;&#x8FD4;&#x56DE;&#x683C;&#x5F0F;&#x3002;</p>
<pre><code>&quot;&quot;&quot;
Answer the following questions as best you can. You have access to the following tools:
{tools}
Use the following format:
Question: the input question you must answer
Thought: you should always think about what to do
Action: the action to take, should be one of [{tool_names}]
Action Input: the input to the action
Observation: the result of the action
... (this Thought/Action/Action Input/Observation can be repeated zero or more times)
Thought: I now know the final answer
Final Answer: the final answer to the original input question
Begin!
history:
{history}
Question: {input}
Thought: {agent_scratchpad}
&quot;&quot;&quot;
</code></pre><p>&#x9664;&#x4E86;&#x4F7F;&#x7528; <code>Zero React</code> &#x7684;&#x63D0;&#x793A;&#x8BCD;&#x65B9;&#x6848;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x5BF9;&#x63D0;&#x793A;&#x8BCD;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528; Langchain &#x63D0;&#x4F9B;&#x7684;&#x5176;&#x4ED6;&#x7684;Agent&#x7ED3;&#x6784;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x4F7F;&#x7528;&#x7684;&#x6A21;&#x578B;&#x4E3A;<code>ChatGLM3-6B</code>&#x6A21;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x8FD0;&#x884C;<code>ChatGLM3-6B</code>&#x7684;Agent&#x63D0;&#x793A;&#x8BCD;&#xFF0C;&#x8BE5;&#x63D0;&#x793A;&#x8BCD;&#x4E0E; Langchain &#x7684; <code>struct Agent</code>&#x76F8;&#x4F3C;&#xFF0C;&#x5176;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>
&quot;ChatGLM3&quot;:
&quot;&quot;&quot;
You can answer using the tools, or answer directly using your knowledge without using the tools.Respond to the human as helpfully and accurately as possible.
You have access to the following tools:
{tools}
Use a json blob to specify a tool by providing an action key (tool name) and an action_input key (tool input).
Valid &quot;action&quot; values: &quot;Final Answer&quot; or  [{tool_names}]
Provide only ONE action per $JSON_BLOB, as shown:

```

  &quot;action&quot;: $TOOL_NAME,
  &quot;action_input&quot;: $INPUT

```
Follow this format:

Question: input question to answer
Thought: consider previous and subsequent steps
Action:
```
$JSON_BLOB
```
Observation: action result
... (repeat Thought/Action/Observation N times)
Thought: I know what to respond
Action:
```

  &quot;action&quot;: &quot;Final Answer&quot;,
  &quot;action_input&quot;: &quot;Final response to human&quot;

Begin! Reminder to ALWAYS respond with a valid json blob of a single action. Use tools if necessary. Respond directly if appropriate. Format is Action:```$JSON_BLOB```then Observation:.

history: {history}

Question: {input}

Thought: {agent_scratchpad}
&quot;&quot;&quot;,
</code></pre><ol>
<li>&#x8BA9;&#x4E0D;&#x652F;&#x6301; Langchain &#x8C03;&#x7528;&#x65B9;&#x5F0F;&#x7684;&#x4F46;&#x5177;&#x5907; Agent &#x80FD;&#x529B;&#x7684;&#x6A21;&#x578B;&#x5C55;&#x73B0;&#x80FD;&#x529B;</li>
</ol>
<p>&#x4EE5;<strong>ChatGLM3-6B</strong>&#x4E3A;&#x4EE3;&#x8868;&#x7684;&#x6A21;&#x578B;&#xFF0C;&#x867D;&#x7136;&#x5177;&#x6709; Function Call &#x80FD;&#x529B;&#xFF0C;&#x4F46;&#x5176;&#x5BF9;&#x9F50;&#x683C;&#x5F0F;&#x4E0E; Langchain &#x63D0;&#x4F9B;&#x9ED8;&#x8BA4;Agent&#x683C;&#x5F0F;&#x5E76;&#x4E0D;&#x7B26;&#x5408;&#xFF0C;&#x56E0;&#x6B64;&#x65E0;&#x6CD5;&#x4F7F;&#x7528; Langchain &#x81EA;&#x8EAB;&#x80FD;&#x529B;&#x5B9E;&#x73B0; Function Call&#x3002;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x6846;&#x67B6;&#x4E2D;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5728; <code>server/Agent/custom_agent/</code> &#x6587;&#x4EF6;&#x5939;&#x4E2D;&#x81EA;&#x884C;&#x590D;&#x73B0;&#x66F4;&#x591A;&#x6A21;&#x578B;&#x7684; Agent &#x80FD;&#x529B;&#x5B9E;&#x73B0;&#x3002;</p>
<p>&#x5728;&#x5B8C;&#x6210;&#x4E0A;&#x8FF0;&#x6B65;&#x9AA4;&#x4E4B;&#x540E;&#xFF0C;&#x60A8;&#x8FD8;&#x9700;&#x8981;&#x5230;<code>server/chat/agent_chat/</code>&#x4E2D;&#x5BFC;&#x5165;&#x60A8;&#x7684;&#x6A21;&#x5757;&#x6765;&#x5B9E;&#x73B0;&#x7279;&#x6B8A;&#x5224;&#x5B9A;&#x3002;</p>
<p>&#x540C;&#x65F6;&#xFF0C;&#x4F60;&#x5E94;&#x8BE5;&#x5728;&#x8C03;&#x7528;&#x5DE5;&#x5177;&#x7684;&#x65F6;&#x5019;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x6A21;&#x677F;&#xFF0C;&#x6211;&#x4EEC;&#x4EE5;<code>GLM</code>&#x7CFB;&#x5217;&#x6A21;&#x578B;&#x8FDB;&#x884C;&#x6F14;&#x793A;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x5728;&#x4F7F;&#x7528;<code>GLM</code>&#x6A21;&#x578B;&#x8FDB;&#x884C;&#x5DE5;&#x5177;&#x8C03;&#x7528;&#xFF0C;&#x4F60;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;<code>model_config.py</code>&#x4E2D;&#x7684;<code>ChatGLM3</code>&#x6A21;&#x677F;&#x3002;</p>
<ol>
<li><p>&#x5C40;&#x9650;&#x6027;</p>
</li>
<li><p>&#x7531;&#x4E8E; React Agent &#x7684;&#x8106;&#x5F31;&#x6027;&#xFF0C;temperature &#x53C2;&#x6570;&#x7684;&#x8BBE;&#x7F6E;&#x5BF9;&#x4E8E;&#x6A21;&#x578B;&#x7684;&#x6548;&#x679C;&#x6709;&#x5F88;&#x5927;&#x7684;&#x5F71;&#x54CD;&#x3002;&#x6211;&#x4EEC;&#x5EFA;&#x8BAE;&#x5F00;&#x53D1;&#x8005;&#x5728;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49; Agent &#x65F6;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x6A21;&#x578B;&#xFF0C;&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x6210;0.1&#x4EE5;&#x4E0B;&#xFF0C;&#x4EE5;&#x8FBE;&#x5230;&#x66F4;&#x597D;&#x7684;&#x6548;&#x679C;&#x3002;</p>
</li>
<li>&#x76EE;&#x524D;&#xFF0C;&#x5B98;&#x65B9;&#x4EC5;&#x5BF9; <strong>ChatGLM3-6B</strong> &#x4E00;&#x79CD;&#x6A21;&#x578B;&#x8FDB;&#x884C;&#x4E86; &#x975E; Langchain &#x5BF9;&#x9F50;&#x683C;&#x5F0F;&#x4E0B;&#x7684;&#x80FD;&#x529B;&#x6FC0;&#x6D3B;&#xFF0C;&#x6211;&#x4EEC;&#x6B22;&#x8FCE;&#x5F00;&#x53D1;&#x8005;&#x81EA;&#x884C;&#x63A2;&#x7D22;&#x5176;&#x4ED6;&#x6A21;&#x578B;&#xFF0C;&#x5E76;&#x63D0;&#x4EA4;&#x5BF9;&#x5E94;&#x7684; PR&#xFF0C;&#x8BA9;&#x6846;&#x67B6;&#x652F;&#x6301;&#x66F4;&#x591A;&#x7684; Agent &#x6A21;&#x578B;&#x3002;</li>
<li>&#x5728;<code>0.2.x</code>&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x5BF9;<code>Plan</code>&#x8FDB;&#x884C;&#x4F18;&#x5316;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x8FDE;&#x7EED;&#x8C03;&#x7528;&#x5DE5;&#x5177;&#x7684;&#x80FD;&#x529B;&#x8F83;&#x5DEE;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x5728;<code>0.3.x</code>&#x4E2D;&#x4F18;&#x5316;&#x8FD9;&#x4E00;&#x95EE;&#x9898;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x7ECF;&#x8FC7;&#x6D4B;&#x8BD5;&#xFF0C;&#x672C;&#x5730;&#x6A21;&#x578B;&#x5728;&#x5DE5;&#x5177;&#x8C03;&#x7528;&#x4E0A;&#x7684;&#x8868;&#x73B0;&#x4E0D;&#x5982;&#x5728;&#x7EBF;&#x6A21;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x66F4;&#x63A8;&#x8350;&#x4F7F;&#x7528; <code>gpt4-1106-Preview</code> &#x6765;&#x5B8C;&#x6210;&#x5DE5;&#x5177;&#x8C03;&#x7528;&#x7684;&#x4EFB;&#x52A1;&#x3002;</li>
</ol>
<h2 id="&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5FAE;&#x8C03;&#x6A21;&#x578B;">&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5FAE;&#x8C03;&#x6A21;&#x578B;</h2>
<ul>
<li>&#x672C;&#x9879;&#x76EE;&#x57FA;&#x4E8E; FastChat &#x52A0;&#x8F7D; LLM &#x670D;&#x52A1;&#xFF0C;&#x6545;&#x9700;&#x4EE5; FastChat &#x52A0;&#x8F7D; PEFT &#x8DEF;&#x5F84;&#x3002;</li>
<li>&#x5F00;&#x53D1;&#x8005;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x8DEF;&#x5F84;&#x540D;&#x79F0;&#x91CC;&#x5FC5;&#x987B;&#x6709; peft &#x8FD9;&#x4E2A;&#x8BCD;&#x3002;</li>
<li>&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x540D;&#x5B57;&#x4E3A; <code>adapter_config.json</code></li>
<li>peft &#x8DEF;&#x5F84;&#x4E0B;&#x5305;&#x542B;.bin &#x683C;&#x5F0F;&#x7684; PEFT &#x6743;&#x91CD;&#xFF0C; peft&#x8DEF;&#x5F84;&#x5728;startup.py&#x4E2D; <code>create_model_worker_app</code> &#x51FD;&#x6570;&#x7684; <code>args.model_names</code> &#x4E2D;&#x6307;&#x5B9A;
```python
  args.model_names = [&quot;/home/ubuntu/your_peft_folder/peft&quot;]</li>
</ul>
<pre><code>- &#x6267;&#x884C;&#x4EE3;&#x7801;&#x4E4B;&#xFF0C;&#x5E94;&#x8BE5;&#x8BBE;&#x5B9A;&#x73AF;&#x5883;&#x53D8;&#x91CF;
</code></pre><p>PEFT_SHARE_BASE_WEIGHTS=true </p>
<pre><code>
&#x6CE8;&#xFF1A;&#x5982;&#x679C;&#x4E0A;&#x8FF0;&#x65B9;&#x5F0F;&#x542F;&#x52A8;&#x5931;&#x8D25;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x4EE5;&#x6807;&#x51C6;&#x7684; FastChat &#x670D;&#x52A1;&#x542F;&#x52A8;&#x65B9;&#x5F0F;&#x5206;&#x6B65;&#x542F;&#x52A8;&#xFF0C;PEFT&#x52A0;&#x8F7D;&#x8BE6;&#x7EC6;&#x6B65;&#x9AA4;&#x53C2;&#x8003;&#x4EE5;&#x4E0B;ISSUE

[&#x52A0;&#x8F7D;lora&#x5FAE;&#x8C03;&#x540E;&#x6A21;&#x578B;&#x5931;&#x6548;](https://github.com/chatchat-space/Langchain-Chatchat/issues/1130#issuecomment-1685291822)

&#x5728;```&#x6700;&#x4F73;&#x5B9E;&#x8DF5;```&#x7AE0;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4E3A;&#x5F00;&#x53D1;&#x8005;&#x505A;&#x4E86;&#x66F4;&#x8BE6;&#x7EC6;&#x7684;&#x6A21;&#x578B;&#x8F7D;&#x5165;&#x6587;&#x6863;&#x3002;

__&#x8BE5;&#x529F;&#x80FD;&#x53EF;&#x80FD;&#x8FD8;&#x5177;&#x6709;&#x4E00;&#x5B9A;&#x7684;Bug&#xFF0C;&#x9700;&#x8981;&#x5F00;&#x53D1;&#x8005;&#x4ED4;&#x7EC6;&#x9002;&#x914D;&#x3002;__


## &#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5D4C;&#x5165;&#x6A21;&#x578B;

- &#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5D4C;&#x5165;&#x6A21;&#x578B;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x9700;&#x8981;&#x5C06;&#x5176;&#x5408;&#x5E76;&#x5230;&#x539F;&#x59CB;&#x7684;&#x5D4C;&#x5165;&#x6A21;&#x578B;&#x4E2D;&#xFF0C;&#x4E4B;&#x540E;&#x4EC5;&#x9700;&#x5C06;&#x5176;&#x8DEF;&#x5F84;&#x6DFB;&#x52A0;&#x5230;```config/model_config.py```&#x4E2D;&#x5E76;&#x9009;&#x62E9;&#x81EA;&#x5DF1;&#x7684;&#x6A21;&#x578B;&#x542F;&#x52A8;&#x5373;&#x53EF;&#x3002;
- &#x5982;&#x679C;&#x60F3;&#x81EA;&#x5DF1;&#x5728;Embedding&#x6A21;&#x578B;&#x4E2D;&#x652F;&#x6301; &#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x9700;&#x8981;&#x5728; ```embeddings/embedding_keywords.txt```&#x4E2D;&#x8BBE;&#x5B9A;&#x597D;&#x81EA;&#x5DF1;&#x7684;&#x5173;&#x952E;&#x5B57;
- &#x8FD0;&#x884C; ```embeddings/add_embedding_keywords.py
</code></pre><ul>
<li>&#x5C06;&#x751F;&#x6210;&#x7684;&#x65B0;Embedding&#x6A21;&#x578B;&#x5730;&#x5740;&#x653E;&#x5165;<code>configs/model_config.py</code>&#x4E2D;&#x5E76;&#x9009;&#x62E9;&#xFF0C;<pre><code>&quot;custom-embedding&quot;: &quot;your path&quot;,
</code></pre>&#x5E76;&#x8BBE;&#x7F6E;<pre><code>EMBEDDING_MODEL = &quot;custom-embedding&quot;
</code></pre>&#x5373;&#x53EF;&#x8C03;&#x7528;&#x52A0;&#x5165;&#x5173;&#x952E;&#x5B57;&#x7684;embedding&#x6A21;&#x578B;&#x3002;
&#x5728;<code>&#x6700;&#x4F73;&#x5B9E;&#x8DF5;</code>&#x7AE0;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4E3A;&#x67D0;&#x51E0;&#x4E2A;&#x5173;&#x952E;&#x8BCD;&#x5B9A;&#x5236;&#x4E86;&#x4E00;&#x4E2A;Embed&#x6A21;&#x578B;&#x3002;</li>
</ul>
<h2 id="&#x65E5;&#x5FD7;&#x529F;&#x80FD;">&#x65E5;&#x5FD7;&#x529F;&#x80FD;</h2>
<ul>
<li>&#x65E5;&#x5FD7;&#x529F;&#x80FD;&#x8BB0;&#x5F55;&#x4E86;&#x5927;&#x6A21;&#x578B;&#x7684;&#x5FC3;&#x8DF3;&#x548C;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;&#x4F20;&#x8F93;&#x8BB0;&#x5F55;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x65E5;&#x5FD7;&#x529F;&#x80FD;&#x67E5;&#x770B;&#x6A21;&#x578B;&#x7684;&#x8FD0;&#x884C;&#x60C5;&#x51B5;&#x3002; </li>
</ul>
<footer class="page-footer"><span class="copyright">&#xA9; snowdreams1006 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x6587;&#x4EF6;&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;&#xFF1A;
2024-05-17 23:23:32
</span></footer>
<script>console.log("plugin-popup....");document.onclick = function(e){ e.target.tagName === "IMG" && window.open(e.target.src,e.target.src)}</script><style>img{cursor:pointer}</style>
						
					</section>
					
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

				</div>
			</div>
			
		</div>

		
		
		<a href="参数配置.html" class="navigation navigation-prev " aria-label="Previous page: 参数配置">
			<i class="fa fa-angle-left"></i>
		</a>
		
		
		<a href="最佳实践.html" class="navigation navigation-next " aria-label="Next page: 最佳实践">
			<i class="fa fa-angle-right"></i>
		</a>
		
		
		
	</div>
	<script>
		var gitbook = gitbook || [];
		gitbook.push(function() {
			gitbook.page.hasChanged({"page":{"title":"自定义","level":"1.5","depth":1,"next":{"title":"最佳实践","level":"1.6","depth":1,"path":"LLM/最佳实践.md","ref":"./LLM/最佳实践.md","articles":[]},"previous":{"title":"参数配置","level":"1.4","depth":1,"path":"LLM/参数配置.md","ref":"./LLM/参数配置.md","articles":[]},"dir":"ltr"},"config":{"plugins":["tbfed-pagefooter","lunr","search","search-pro","back-to-top-button","copy-code-button","cuav-chapters","heading-anchors","highlight","chapter-fold","expandable-chapters","theme-fexa","code","splitter","tbfed-pagefooter","popup","page-toc-button","accordion"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"&copy snowdreams1006","modify_label":"文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"chapter-fold":{},"splitter":{},"search-pro":{},"accordion":{},"search":{},"cuav-chapters":{"summaryMaxSize":20,"useLimitExpanded":false},"popup":{},"theme-fexa":{},"lunr":{"ignoreSpecialCharacters":false,"maxIndexSize":1000000},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"heading-anchors":{},"highlight":{},"page-toc-button":{},"back-to-top-button":{},"copy-code-button":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"expandable-chapters":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"NLG-Chat","gitbook":"*"},"file":{"path":"LLM/自定义.md","mtime":"2024-05-17T15:23:32.254Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2024-05-17T16:26:38.237Z"},"basePath":"..","book":{"language":""}});
		});
	</script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-cuav-chapters/cuav-chapters.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.2.1/anchor.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-heading-anchors/anchor-style.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-accordion/accordionSelector.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-fexa/fexa.js"></script>
        
    

    </body>
</html>

